(()=>{function e(){var e=document.querySelector("#adminmenuwrap"),t=document.querySelector(".block-roles-save-bar");e&&t&&(e=e.offsetWidth,t.style.left=e+"px")}wp.domReady((function(){let e=!1;function t(){document.getElementById("export-block-roles"),document.querySelector('label[for="import-block-roles-file"]')}function n(e){var t,n=e.closest("td").querySelector(".toggle-status");n?(t=e.checked,n.textContent=t?"Available":"Hidden",n.classList.toggle("status-visible",t),n.classList.toggle("status-hidden",!t)):console.warn("No status span found for checkbox:",e)}function o(){var e=document.getElementById("save-block-roles-settings"),t=document.getElementById("unsaved-changes-message");t||((t=document.createElement("p")).id="unsaved-changes-message",t.style.color="red",t.style.fontWeight="bold",t.style.marginBottom="10px",t.textContent="Unsaved Changes!",e.parentElement.insertBefore(t,e)),e&&(e.style.backgroundColor="red",e.style.borderColor="red")}function a(){var e=document.getElementById("save-block-roles-settings"),t=document.getElementById("unsaved-changes-message");e&&(e.style.backgroundColor="",e.style.borderColor=""),t&&t.remove(),document.querySelectorAll(".unsaved-change").forEach((function(e){e.classList.remove("unsaved-change")}))}t(),document.querySelectorAll(".individual-toggle").forEach((function(e){n(e)})),document.getElementById("export-block-roles").addEventListener("click",(function(){var e=blockRolesSettings.block_roles_settings,t=(new Date).toISOString().split("T")[0],n=(t=window.location.hostname+`-block-roles-${t}.json`,e=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),e=URL.createObjectURL(e),document.createElement("a"));n.href=e,n.download=t,document.body.appendChild(n),n.click(),document.body.removeChild(n)})),document.getElementById("import-block-roles-file").addEventListener("change",(function(t){var o;(t=t.target.files[0])&&((o=new FileReader).onload=function(t){try{var o=JSON.parse(t.target.result);confirm("Are you sure you want to overwrite the current settings with the imported file?")&&jQuery.ajax({url:ajaxurl,method:"POST",data:{action:"acemedia_block_roles_import_settings",security:blockRolesSettings.nonce,block_roles_settings:o},success:function(t){if(t.success){var o=t;if(o.success){let t=o.data.updated_settings;document.querySelectorAll(".individual-toggle").forEach((function(e){var o,a=e.closest("tr").querySelector("td[data-block-name]");a?(a=a.getAttribute("data-block-name"),o=e.getAttribute("data-role"),t.hasOwnProperty(a)&&t[a].hasOwnProperty(o)?(a=t[a][o],e.checked="1"===a||1===a||!0===a||"true"===a):e.checked=!1,n(e)):console.warn("No status span found for checkbox:",e)})),e=!1,a(),l(o.data.message)}else l("Failed to import settings. Please try again.");l(t.data.message)}else l("Failed to import settings. Please try again.")},error:function(){l("Failed to import settings. Please try again.")}})}catch(t){alert("Invalid JSON file. Please check the format and try again.")}},o.readAsText(t))}));let s=document.querySelector('form[action="options.php"]');function l(e){let t=document.querySelector('input[name="save-block-roles-settings"]');if(t){let n=t.style.background;t.value="Saving...",setTimeout((()=>{t.value=e,t.style.background="green"}),1e3),setTimeout((()=>{t.value="Save Settings",t.style.background=n}),2500)}}s&&s.addEventListener("submit",(function(n){n.preventDefault(),n=new FormData(s);let o={};n.forEach(((e,t)=>{var n;t.startsWith("block_roles_settings")&&(t=t.match(/\[(.*?)\]\[(.*?)\]/))&&(n=t[1],t=t[2],o[n]||(o[n]={}),o[n][t]="1"===e?1:0)})),jQuery.ajax({url:ajaxurl,method:"POST",data:{action:"acemedia_block_roles_save_settings",security:blockRolesSettings.nonce,block_roles_settings:o},success:function(n){n.success?(function(n){blockRolesSettings.block_roles_settings=n,e=!1,t(),a(),document.querySelectorAll(".slider.round").forEach((function(t){e?t.parentElement.parentElement.classList.add("unsaved-changes"):t.parentElement.parentElement.classList.remove("unsaved-changes")}))}(n.data.updated_settings),l(n.data.message)):(l("Failed to save settings. Please try again."),s.submit())},error:function(){l("Failed to save settings. Please try again."),s.submit()}})})),document.querySelectorAll(".toggle-all-btn").forEach((function(t){t.addEventListener("click",(function(){var t=this.getAttribute("data-role"),a=this.getAttribute("data-category");t=document.querySelectorAll(`.individual-toggle[data-role="${t}"][data-category="${a}"]`);let s=!Array.from(t).every((e=>e.checked));t.forEach((function(t){t.checked=s,n(t),e=!0,t.parentElement.parentElement.classList.add("unsaved-change")})),o()}))})),document.querySelectorAll(".individual-toggle").forEach((function(t){t.addEventListener("change",(function(){n(this),e=!0,this.parentElement.parentElement.classList.add("unsaved-change"),o()}))}))})),window.addEventListener("resize",e),window.addEventListener("scroll",e),window.addEventListener("load",e);let t=document.querySelector("#collapse-button");t&&t.addEventListener("click",(()=>{setTimeout(e,3)})),document.getElementById("import-block-roles-button").addEventListener("click",(function(){document.getElementById("import-block-roles-file").click()}))})();